{% includeJsResource "sproutforms/js/customFieldSettings.js" %}

{%- set value        = element is not empty ? element.getFieldValue(field.handle) -%}
{%- set errors       = element is not empty ? element.getErrors(field.handle) -%}
{%- set label        = field.name is defined ? field.name -%}
{%- set handle       = field.handle is defined ? field.handle -%}
{%- set options      = attribute(renderingOptions.fields, handle) is defined ? attribute(renderingOptions.fields, handle) : {} -%}
{%- set settings     = field.settings -%}
{%- set instructions = field.instructions is defined ? field.instructions -%}
{%- set input        = formField.getInputHtml(field, value, settings, options) -%}

{#{% do field.setAttribute('required', required is defined ? required : null) %}#}

{#{%- set fieldInfo = craft.sproutForms.getFieldInfo(field, element, renderingOptions) -%}#}
{#{%- set input = fieldInfo.input -%}#}
{#{%- set namespace = (fieldInfo.namespace is defined ? fieldInfo.namespace : 'fields') -%}#}
{#&#123;&#35; If this is a third party submission, don't append namespace to anything &#35;&#125;#}
{#{%- set namespace = (not thirdPartySubmission) ? namespace : null -%}#}

{#{%- set isNakedField = (fieldInfo.isNakedField is defined ? fieldInfo.isNakedField : null) -%}#}
{#{%- set type = fieldInfo.type|lower -%}#}
{#{%- set value = (element ? element.getFieldValue(field.handle) : null) -%}#}
{#{%- set errors = element.getErrors(field.handle) -%}#}

{% set namespace = not thirdPartySubmission ? formField.getNamespace() %}

{% namespace namespace %}
	{% if formField.isPlainInput() %}

		{{ input }}

	{% else %}
		<div class="
			{% if renderingOptions.mainDivClass is defined %} {{renderingOptions.mainDivClass}} {% endif %} field {{ field.type }}{% if first is defined and first %} first{% endif %}{% if class is defined and class
		%} {{ class }}{% endif %}{% if errors %} has-errors{% endif %}"{% if handle %} id="{{ handle }}-field"{% endif
		%}>

			{% if label or instructions %}
				<div class="heading">
					{% if label %}
						<label{% if required is defined and required %} class="required"{% endif %}{% if handle %} for="{{ handle }}"{% endif %}>
							{{ label|raw }}
						</label>
					{% endif %}
					{% if instructions %}
						<p class="instructions">{{ instructions|raw }}</p>
					{% endif %}
				</div>
			{% endif %}

			<div class="input{% if errors %} errors{% endif %}">
				<div class="{% if renderingOptions.inputDivClass is defined %} {{renderingOptions.inputDivClass}} {% endif %}">
					{{ input }}
				</div>
			</div>

			{% include "errorList" with { errors: errors } %}

		</div>
	{% endif %}
{% endnamespace %}
